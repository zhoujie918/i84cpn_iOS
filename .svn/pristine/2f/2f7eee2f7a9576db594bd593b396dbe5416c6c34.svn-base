//
//  CPLineInfoView.swift
//  i84cpn
//
//  Created by 周杰 on 16/5/17.
//  Copyright © 2016年 5i84. All rights reserved.
//  线路详情

import UIKit

class CPLineInfoView: UIView,ZHDropDownMenuDelegate {
    var scrollView=UIScrollView()
    var contentView=UIView()
    
    var lineView=UIView()           //线路View
    var orderView=UIView()          //预定View
    var comfirmView=UIView()        //确认View
    var lineBackView=UIView()       //返程线路View
    var submit=UIButton()           //购票按钮
    
    //-----------lineView UI---------
    var lineNameLb=UILabel()        //线路名称
    var priceLb=UILabel()           //线路价格
    var priceUnitLb=UILabel()       //价格单位
    var gradeKey=UIView()
    var gradeLb=UILabel()           //推荐年级
    var stationLb=UILabel()         //途经站点
    var stationValue=UILabel()      //站点名称
    var lineDetailMap=UILabel()     //查看详细路线图
    var busDateKit=UITextField()        //日期控件
    var startStationLb=UILabel()    //上车站点
    var startTimeLb=UILabel()       //上车时间
    var startStationDropMenu:ZHDropDownMenu!        //站点下拉框
    var timeImgView=UIImageView()                   //时间图片
    var timeValue=UILabel()                         //时间显示
    var orderTermValue=UILabel()                    //期次内容
//    var addressText=IQTextView()    //通讯地址输入框
    var addPassgerAddress=UIButton()

    
    //--------------lineBackView UI-----------
    var lineBackNameKey=UILabel()
    var priceBackValue=UILabel()
    var priceUnitBackKey=UILabel()
    var gradeBackKey=UIView()
    var gradeBackValue=UILabel()
    var stationBackKey=UILabel()
    var stationBackValue=UILabel()
    var lineDetailMapBack=UILabel()
    var startStationBackKey=UILabel()
    var startStationBackDropMenu:ZHDropDownMenu!
    var startTimeKey=UILabel()
    var timeBackImgView=UIImageView()
    var timeBackValue=UILabel()
    var wLabel=UILabel()
    var fLabel=UILabel()
    var connectAddress=UILabel()

//    var psgListView=UIView()        //乘客列表
//    var passgerCbx=UIButton()       //乘客多选框
//    var passgerName=UILabel()
    
    var psgView=UIView()
    
//    var addressDropMenu:ZHDropDownMenu!
    var addPassgerBtn=UIButton()    //乘客添加按钮
    var agreementCbx=UIButton()     //合同勾选框
    var billCbx=UIButton()          //发票勾选框
//    @IBOutlet weak var calendarHeight: NSLayoutConstraint!
    
    var moveWayKey=UILabel()        //开行方式key
    var moveWayValue=UILabel()      //开行方式value

    var dateView = UIView()
    
    var datePicker=UIDatePicker()
    var dropRowW:Int!
    var dropRowF:Int!
    var newDateArray=NSMutableArray()
    
    var startDate:AnyObject!
    var isNeedContract:Int!
    
    var startStation:String!
    var endStation:String!
    
//    var resultList=NSArray()
    var addressDropMenu=ZHDropDownMenu()

    var stationListAr=NSArray()
    var stationListArBack=NSArray()
    
    var psgIdsSelectedAr=NSMutableArray()
    
    var psgButtonArray=NSMutableArray() as! [UIButton]
    
    var dropRowAddress:Int!
    
    var psgAddressAr=NSArray()
    
    
        
    @IBOutlet weak var calendarView: NWCalendarView!
    
    
    // Only override drawRect: if you perform custom drawing.
    // An empty implementation adversely affects performance during animation.
    override func drawRect(rect: CGRect) {
        isNeedContract=0
        //-------------------------scrollView------------------------
        self.addSubview(scrollView)
        scrollView.backgroundColor=COLOR_BACKGROUND_GRAY
        scrollView.bounces=false
        scrollView.snp_makeConstraints { make in
            make.edges.equalTo(self).offset(UIEdgeInsetsZero)
        }
        
        //-------------------------contentView，边界值在底部------------------------
        scrollView.addSubview(contentView)
        contentView.backgroundColor=COLOR_BACKGROUND_GRAY
        
        //－－－－－－－－－－－－－－－lineView线路视图－－－－－－－－－－－－－－－－－
        contentView.addSubview(lineView)
        lineView.layer.borderWidth=1
        lineView.layer.borderColor=COLOR_SEGMENTATION.CGColor
        lineView.backgroundColor=UIColor.whiteColor()
        lineView.snp_makeConstraints { (make) in
            make.top.equalTo(contentView).offset(HEIGHT_DYNAMIC(15))
            make.left.equalTo(contentView).offset(0)
            make.right.equalTo(contentView).offset(0)
//            make.height.equalTo((220))
        }
        //"往"字
        lineView.addSubview(wLabel)
        wLabel.text="[往] "
        wLabel.textColor=COLOR_TEXT_ORANGE
        wLabel.font=UIFont.systemFontOfSize(15)
        wLabel.snp_makeConstraints { (make) in
            make.top.equalTo(lineView).offset(HEIGHT_DYNAMIC(20))
            make.left.equalTo(lineView).offset(WIDTH_DYNAMIC(15))
        }
        //线路名称
        lineView.addSubview(lineNameLb)
        lineNameLb.font=UIFont.systemFontOfSize(15)
        lineNameLb.text=" "
        lineNameLb.snp_makeConstraints { (make) in
            make.top.equalTo(lineView).offset(HEIGHT_DYNAMIC(20))
            make.left.equalTo(wLabel.snp_right).offset(0)
            make.width.lessThanOrEqualTo(self.bounds.size.width/3*2)
        }
        //价格单位
        lineView.addSubview(priceUnitLb)
        priceUnitLb.text="元/趟"
        priceUnitLb.font=UIFont.systemFontOfSize(12)
        priceUnitLb.snp_makeConstraints { (make) in
            make.top.equalTo(lineView).offset(HEIGHT_DYNAMIC(25))
            make.right.equalTo(lineView).offset(WIDTH_DYNAMIC(-15))
        }
        
        //价格
        lineView.addSubview(priceLb)
        priceLb.font=UIFont.systemFontOfSize((24))
//        priceLb.text="8"
        priceLb.textColor=COLOR_TEXT_YELLOW
        priceLb.snp_makeConstraints { (make) in
//            make.top.equalTo(lineView).offset(HEIGHT_DYNAMIC(15))
            make.right.equalTo(priceUnitLb.snp_left)
            make.bottom.equalTo(priceUnitLb.snp_bottom).offset(5)
        }
        //推荐年级
        lineView.addSubview(gradeLb)
        gradeLb.backgroundColor=COLOR_BACKGROUND_GRAY
        gradeLb.numberOfLines=2
        gradeLb.font=UIFont.systemFontOfSize(12)
//        gradeLb.layer.borderWidth=1
//        gradeLb.layer.borderColor=COLOR_SEGMENTATION.CGColor
//        gradeLb.text="推荐初一、初二年级乘坐，寄宿生专线，\n全程22公里，预计45分钟"
        gradeLb.textAlignment=NSTextAlignment.Center
        gradeLb.textColor=UIColor(red: 154/255, green: 154/255, blue: 154/255, alpha: 1)
        gradeLb.snp_makeConstraints { (make) in
            make.top.equalTo(lineNameLb.snp_bottom).offset(HEIGHT_DYNAMIC(15))
            make.left.equalTo(lineView).offset(WIDTH_DYNAMIC(15))
            make.right.equalTo(lineView).offset(WIDTH_DYNAMIC(-15))
        }
        //推荐年级背景视图
        lineView.addSubview(gradeKey)
        gradeKey.backgroundColor=COLOR_BACKGROUND_GRAY
        gradeKey.layer.borderWidth=1
        gradeKey.layer.borderColor=COLOR_SEGMENTATION.CGColor
        gradeKey.snp_makeConstraints { (make) in
            make.top.equalTo(gradeLb.snp_top).offset(-5)
            make.bottom.equalTo(gradeLb.snp_bottom).offset(5)
            make.left.equalTo(gradeLb.snp_left).offset(-5)
            make.right.equalTo(gradeLb.snp_right).offset(5)
        }
        lineView.insertSubview(gradeLb, aboveSubview: gradeKey)
        //途经站点
        lineView.addSubview(stationLb)
        stationLb.text="途经站点"
        stationLb.font=UIFont.systemFontOfSize(13)
        stationLb.snp_makeConstraints { (make) in
            make.top.equalTo(gradeLb.snp_bottom).offset(HEIGHT_DYNAMIC(20))
            make.left.equalTo(lineView).offset(WIDTH_DYNAMIC(15))
            make.width.lessThanOrEqualTo(WIDTH_DYNAMIC(55))
        }
        //站点值
        lineView.addSubview(stationValue)
//        stationValue.text="紫阳中学、正大广场、状元净、汽车北站、南公园、连江、西湖公园、深林公园、白马河、三坊七巷"
        stationValue.font=UIFont.systemFontOfSize(13)
        stationValue.textColor=COLOR_TEXT
        stationValue.numberOfLines=2
        stationValue.snp_makeConstraints { (make) in
            make.top.equalTo(stationLb.snp_top).offset(0)
            make.left.equalTo(stationLb.snp_right).offset(WIDTH_DYNAMIC(15))
            make.right.equalTo(lineView).offset(WIDTH_DYNAMIC(-15))
        }
        //查看详细线路图
        lineView.addSubview(lineDetailMap)
        lineDetailMap.font=UIFont.boldSystemFontOfSize(13)
        lineDetailMap.text="查看详细线路图"
        let attrs=[NSUnderlineColorAttributeName:COLOR_TEXT_ORANGE,NSUnderlineStyleAttributeName:1,NSForegroundColorAttributeName:COLOR_TEXT_ORANGE]
        let underLineStr=NSMutableAttributedString(string: lineDetailMap.text!, attributes: attrs)
        lineDetailMap.attributedText=underLineStr
        lineDetailMap.snp_makeConstraints { (make) in
            make.top.equalTo(stationValue.snp_bottom).offset(HEIGHT_DYNAMIC(5))
            make.left.equalTo(stationLb.snp_right).offset(WIDTH_DYNAMIC(15))
        }
//        let lineDetailMapGest=UIGestureRecognizer(target: self, action: "lineDetailMapClick")
//        lineDetailMap.addGestureRecognizer(lineDetailMapGest)

        //上车站点
        lineView.addSubview(startStationLb)
        startStationLb.font=UIFont.systemFontOfSize(13)
        startStationLb.text="上车站点"
        startStationLb.snp_makeConstraints { (make) in
            make.top.equalTo(lineDetailMap.snp_bottom).offset(HEIGHT_DYNAMIC(21))
            make.left.equalTo(lineView).offset(WIDTH_DYNAMIC(15))
        }
        //站点下拉框
        startStationDropMenu=ZHDropDownMenu()
        contentView.addSubview(startStationDropMenu)
//        lineView.bringSubviewToFront(contentView)
        startStationDropMenu.dropMenuTag=1
        startStationDropMenu.delegate=self
        startStationDropMenu.buttonImage=UIImage(named: "icon_down")
        startStationDropMenu.editable=false
        startStationDropMenu.font=UIFont.systemFontOfSize(12)
        startStationDropMenu.textColor=COLOR_TEXT
        startStationDropMenu.layer.borderColor=COLOR_SEGMENTATION.CGColor
        startStationDropMenu.layer.borderWidth=1
        startStationDropMenu.options=[""]
        startStationDropMenu.defaultValue=""
        startStationDropMenu.snp_makeConstraints { (make) in
            make.top.equalTo(lineDetailMap.snp_bottom).offset(HEIGHT_DYNAMIC(15))
            make.left.equalTo(startStationLb.snp_right).offset(WIDTH_DYNAMIC(15))
            make.right.equalTo(lineView).offset(WIDTH_DYNAMIC(-15))
            make.height.equalTo(30)
        }
//        lineView.insertSubview(startStationDropMenu, aboveSubview: lineView)
        
        //上车时间
        lineView.addSubview(startTimeLb)
        startTimeLb.text="上车时间"
        startTimeLb.font=UIFont.systemFontOfSize(13)
        startTimeLb.snp_makeConstraints { (make) in
            make.top.equalTo(startStationLb.snp_bottom).offset(HEIGHT_DYNAMIC(25))
            make.left.equalTo(lineView).offset(WIDTH_DYNAMIC(15))
        }
        //timeImgView
        lineView.addSubview(timeImgView)
        timeImgView.image=UIImage(named: "icon_time")
        timeImgView.snp_makeConstraints { (make) in
            make.top.equalTo(startStationLb.snp_bottom).offset(HEIGHT_DYNAMIC(25))
            make.left.equalTo(startTimeLb.snp_right).offset(WIDTH_DYNAMIC(15))
        }
        //timeValue
        lineView.addSubview(timeValue)
        timeValue.text="07:30"
        timeValue.font=UIFont.systemFontOfSize(13)
        timeValue.textColor=COLOR_TEXT
        timeValue.snp_makeConstraints { (make) in
            make.top.equalTo(startStationLb.snp_bottom).offset(HEIGHT_DYNAMIC(25))
            make.left.equalTo(timeImgView.snp_right).offset(WIDTH_DYNAMIC(15))
        }
        
        lineView.snp_updateConstraints { (make) in
            make.bottom.equalTo(timeImgView.snp_bottom).offset(5)
        }
        //--------------------lineBackView-----------------
        contentView.addSubview(lineBackView)
        lineBackView.backgroundColor=UIColor.whiteColor()
        lineBackView.layer.borderWidth=1
        lineBackView.layer.borderColor=COLOR_SEGMENTATION.CGColor
        lineBackView.snp_makeConstraints { (make) in
            make.top.equalTo(lineView.snp_bottom).offset(HEIGHT_DYNAMIC(15))
            make.left.right.equalTo(contentView).offset(0)
//            make.height.equalTo(300)
        }
        //返字
        lineBackView.addSubview(fLabel)
        fLabel.text="[返] "
        fLabel.font=UIFont.systemFontOfSize(15)
        fLabel.textColor=COLOR_TEXT_ORANGE
        fLabel.snp_makeConstraints { (make) in
            make.top.equalTo(lineBackView).offset(HEIGHT_DYNAMIC(20))
            make.left.equalTo(lineBackView).offset(WIDTH_DYNAMIC(15))
        }
        
        //返程线路名称
        lineBackView.addSubview(lineBackNameKey)
        lineBackNameKey.text=" "
        lineBackNameKey.font=UIFont.systemFontOfSize(15)
        lineBackNameKey.snp_makeConstraints { (make) in
            make.top.equalTo(lineBackView).offset(HEIGHT_DYNAMIC(20))
            make.left.equalTo(fLabel.snp_right).offset(0)
            make.width.lessThanOrEqualTo(self.bounds.size.width/3*2)
        }
        
        //返程价格单位
        lineBackView.addSubview(priceUnitBackKey)
        priceUnitBackKey.text="元/趟"
        priceUnitBackKey.font=UIFont.systemFontOfSize(12)
        priceUnitBackKey.snp_makeConstraints { (make) in
            make.top.equalTo(lineBackView).offset(HEIGHT_DYNAMIC(25))
            make.right.equalTo(lineBackView).offset(WIDTH_DYNAMIC(-15))
        }
        
        //返程价格
        lineBackView.addSubview(priceBackValue)
        priceBackValue.font=UIFont.systemFontOfSize((24))
//        priceBackValue.text="8"
        priceBackValue.textColor=COLOR_TEXT_YELLOW
        priceBackValue.snp_makeConstraints { (make) in
            //            make.top.equalTo(lineView).offset(HEIGHT_DYNAMIC(15))
            make.right.equalTo(priceUnitBackKey.snp_left)
            make.bottom.equalTo(priceUnitBackKey.snp_bottom).offset(5)
        }

        //返程推荐年级
        lineBackView.addSubview(gradeBackValue)
        gradeBackValue.backgroundColor=COLOR_BACKGROUND_GRAY
        gradeBackValue.numberOfLines=2
        gradeBackValue.font=UIFont.systemFontOfSize(12)
//        gradeBackValue.layer.borderWidth=1
//        gradeBackValue.layer.borderColor=COLOR_SEGMENTATION.CGColor
//        gradeBackValue.text="推荐初一、初二年级乘坐，寄宿生专线，\n全程22公里，预计45分钟"
        gradeBackValue.textAlignment=NSTextAlignment.Center
        gradeBackValue.textColor=UIColor(red: 154/255, green: 154/255, blue: 154/255, alpha: 1)
        gradeBackValue.snp_makeConstraints { (make) in
            make.top.equalTo(lineBackNameKey.snp_bottom).offset(HEIGHT_DYNAMIC(15))
            make.left.equalTo(lineBackView).offset(WIDTH_DYNAMIC(15))
            make.right.equalTo(lineBackView).offset(WIDTH_DYNAMIC(-15))
//            make.leftMargin.equalTo(5)
        }
        //返程推荐年级背景视图
        lineBackView.addSubview(gradeBackKey)
        gradeBackKey.backgroundColor=COLOR_BACKGROUND_GRAY
        gradeBackKey.bringSubviewToFront(gradeBackValue)
        gradeBackKey.layer.borderWidth=1
        gradeBackKey.layer.borderColor=COLOR_SEGMENTATION.CGColor
        gradeBackKey.snp_makeConstraints { (make) in
            make.top.equalTo(gradeBackValue.snp_top).offset(-5)
            make.bottom.equalTo(gradeBackValue.snp_bottom).offset(5)
            make.left.equalTo(gradeBackValue.snp_left).offset(-5)
            make.right.equalTo(gradeBackValue.snp_right).offset(5)
        }
        lineBackView.insertSubview(gradeBackValue, aboveSubview: gradeBackKey)
        
        //返程途经站点
        lineBackView.addSubview(stationBackKey)
        stationBackKey.text="途经站点"
        stationBackKey.font=UIFont.systemFontOfSize(13)
        stationBackKey.snp_makeConstraints { (make) in
            make.top.equalTo(gradeBackValue.snp_bottom).offset(HEIGHT_DYNAMIC(20))
            make.left.equalTo(lineBackView).offset(WIDTH_DYNAMIC(15))
            make.width.lessThanOrEqualTo(WIDTH_DYNAMIC(60))
        }
        
        //返程站点值
        lineBackView.addSubview(stationBackValue)
//        stationBackValue.text="紫阳中学、正大广场、状元净、汽车北站、南公园、连江、西湖公园、深林公园、白马河、三坊七巷"
        stationBackValue.font=UIFont.systemFontOfSize(13)
        stationBackValue.textColor=COLOR_TEXT
        stationBackValue.numberOfLines=2
        stationBackValue.snp_makeConstraints { (make) in
            make.top.equalTo(stationBackKey.snp_top).offset(0)
            make.left.equalTo(stationBackKey.snp_right).offset(WIDTH_DYNAMIC(15))
            make.right.equalTo(lineBackView).offset(WIDTH_DYNAMIC(-15))
        }
        
        //返程查看详细线路图
        lineBackView.addSubview(lineDetailMapBack)
        lineDetailMapBack.font=UIFont.boldSystemFontOfSize(13)
        lineDetailMapBack.text="查看详细线路图"
//        let attrs=[NSUnderlineColorAttributeName:COLOR_TEXT_ORANGE,NSUnderlineStyleAttributeName:1,NSForegroundColorAttributeName:COLOR_TEXT_ORANGE]
//        let underLineStr=NSMutableAttributedString(string: lineDetailMap.text!, attributes: attrs)
        lineDetailMapBack.attributedText=underLineStr
        lineDetailMapBack.snp_makeConstraints { (make) in
            make.top.equalTo(stationBackValue.snp_bottom).offset(HEIGHT_DYNAMIC(5))
            make.left.equalTo(stationBackKey.snp_right).offset(WIDTH_DYNAMIC(16))
        }
        //        let lineDetailMapGest=UIGestureRecognizer(target: self, action: "lineDetailMapClick")
        //        lineDetailMap.addGestureRecognizer(lineDetailMapGest)
        
        //返程上车站点
        lineBackView.addSubview(startStationBackKey)
        startStationBackKey.font=UIFont.systemFontOfSize(13)
        startStationBackKey.text="下车站点"
        startStationBackKey.snp_makeConstraints { (make) in
            make.top.equalTo(lineDetailMapBack.snp_bottom).offset(HEIGHT_DYNAMIC(21))
            make.left.equalTo(lineBackView).offset(WIDTH_DYNAMIC(15))
        }
        
        //返程站点下拉框
        startStationBackDropMenu=ZHDropDownMenu()
        contentView.addSubview(startStationBackDropMenu)
//        scrollView
        startStationBackDropMenu.dropMenuTag=2
        startStationBackDropMenu.delegate=self
        startStationBackDropMenu.buttonImage=UIImage(named: "icon_down")
        startStationBackDropMenu.editable=false
        startStationBackDropMenu.font=UIFont.systemFontOfSize(12)
        startStationBackDropMenu.textColor=COLOR_TEXT
        startStationBackDropMenu.layer.borderColor=COLOR_SEGMENTATION.CGColor
        startStationBackDropMenu.layer.borderWidth=1
        startStationBackDropMenu.options=[""]
        startStationBackDropMenu.defaultValue=""
        startStationBackDropMenu.snp_makeConstraints { (make) in
            make.top.equalTo(lineDetailMapBack.snp_bottom).offset(HEIGHT_DYNAMIC(15))
            make.left.equalTo(stationBackKey.snp_right).offset(WIDTH_DYNAMIC(15))
            make.right.equalTo(lineBackView).offset(WIDTH_DYNAMIC(-15))
            make.height.equalTo(30)
        }
        
        //返程上车时间
        lineBackView.addSubview(startTimeKey)
        startTimeKey.text="发车时间"
        startTimeKey.font=UIFont.systemFontOfSize(13)
        startTimeKey.snp_makeConstraints { (make) in
            make.top.equalTo(startStationBackKey.snp_bottom).offset(HEIGHT_DYNAMIC(25))
            make.left.equalTo(lineBackView).offset(WIDTH_DYNAMIC(15))
        }
        //返程timeBackImgView
        lineBackView.addSubview(timeBackImgView)
        timeBackImgView.image=UIImage(named: "icon_time")
        timeBackImgView.snp_makeConstraints { (make) in
            make.top.equalTo(startStationBackKey.snp_bottom).offset(HEIGHT_DYNAMIC(25))
            make.left.equalTo(startTimeKey.snp_right).offset(WIDTH_DYNAMIC(15))
        }
        //返程timeBackValue
        lineBackView.addSubview(timeBackValue)
        timeBackValue.text="07:30"
        timeBackValue.font=UIFont.systemFontOfSize(13)
        timeBackValue.textColor=COLOR_TEXT
        timeBackValue.snp_makeConstraints { (make) in
            make.top.equalTo(startStationBackKey.snp_bottom).offset(HEIGHT_DYNAMIC(25))
            make.left.equalTo(timeBackImgView.snp_right).offset(WIDTH_DYNAMIC(15))
        }
        
        
        lineBackView.snp_updateConstraints { (make) in
            make.bottom.equalTo(timeBackImgView.snp_bottom).offset(5)
//            make.bottom.equalTo(lineView.snp_bottom).offset(HEIGHT_DYNAMIC(0))
        }
        
        //－－－－－－－－－－－－－－－－orderView预订视图－－－－－－－－－－－－－
        contentView.addSubview(orderView)
        orderView.backgroundColor=UIColor.whiteColor()
        orderView.layer.borderWidth=1
        orderView.layer.borderColor=COLOR_SEGMENTATION.CGColor
        orderView.snp_makeConstraints { (make) in
            make.top.equalTo(lineBackView.snp_bottom).offset(HEIGHT_DYNAMIC(15))
            make.left.right.equalTo(contentView).offset(0)
        }
        //预定期次
        let orderTerm=UILabel()
        orderView.addSubview(orderTerm)
        orderTerm.font=UIFont.systemFontOfSize(13)
        orderTerm.text="预订期次"
        orderTerm.snp_makeConstraints { (make) in
            make.top.equalTo(orderView).offset(HEIGHT_DYNAMIC(20))
            make.left.equalTo(orderView).offset(WIDTH_DYNAMIC(20))
        }
        //期次内容
        orderView.addSubview(orderTermValue)
        orderTermValue.textColor=COLOR_TEXT
//        orderTermValue.text="2015-2016学年第一学期"
        orderTermValue.font=UIFont.systemFontOfSize(13)
        orderTermValue.snp_makeConstraints { (make) in
            make.top.equalTo(orderTerm.snp_top)
            make.left.equalTo(orderTerm.snp_right).offset(WIDTH_DYNAMIC(15))
        }
        
        //开行方式key
        orderView.addSubview(moveWayKey)
        moveWayKey.text="开行方式"
        moveWayKey.font=UIFont.systemFontOfSize(13)
        moveWayKey.snp_makeConstraints { (make) in
            make.top.equalTo(orderTerm.snp_bottom).offset(HEIGHT_DYNAMIC(15))
            make.left.equalTo(orderView).offset(WIDTH_DYNAMIC(20))
        }
        
        //开行方式value
        orderView.addSubview(moveWayValue)
        moveWayValue.text=" "
        moveWayValue.textColor=COLOR_TEXT
        moveWayValue.font=UIFont.systemFontOfSize(13)
        moveWayValue.snp_makeConstraints { (make) in
            make.top.equalTo(orderTerm.snp_bottom).offset(HEIGHT_DYNAMIC(15))
            make.left.equalTo(moveWayKey.snp_right).offset(15)
        }
        
        //乘车日期
        let busDate=UILabel()
        orderView.addSubview(busDate)
        busDate.text="乘车日期"
        busDate.font=UIFont.systemFontOfSize(13)
        busDate.snp_makeConstraints { (make) in
            make.top.equalTo(moveWayKey.snp_bottom).offset(HEIGHT_DYNAMIC(20))
            make.left.equalTo(orderView).offset(WIDTH_DYNAMIC(20))
        }
        //日期控件
        busDateKit.userInteractionEnabled=true
        busDateKit.layer.borderColor=COLOR_SEGMENTATION.CGColor
        busDateKit.layer.borderWidth=1
        busDateKit.layer.cornerRadius=2.5
        busDateKit.font=UIFont.systemFontOfSize(13)
        busDateKit.leftView=UIView(frame: CGRectMake(0,0,13,10))
        busDateKit.leftViewMode=UITextFieldViewMode.Always
        busDateKit.textColor=COLOR_TEXT
        orderView.addSubview(busDateKit)
        busDateKit.snp_makeConstraints { (make) in
            make.top.equalTo(moveWayKey.snp_bottom).offset(HEIGHT_DYNAMIC(15))
//            make.left.equalTo(busDate.snp_right).offset(WIDTH_DYNAMIC(15))
            make.right.equalTo(orderView).offset(WIDTH_DYNAMIC(-15))
            make.width.equalTo(startStationDropMenu.snp_width)
            make.height.equalTo(30)
        }
        let busDateGest=UITapGestureRecognizer()
        busDateGest.addTarget(self, action: #selector(CPLineInfoView.dateChoose))
        busDateGest.numberOfTapsRequired=1
        busDateKit.addGestureRecognizer(busDateGest)
        //添加乘客
        let passenger=UILabel()
        orderView.addSubview(passenger)
        passenger.text="添加乘客"
        passenger.font=UIFont.systemFontOfSize(13)
        passenger.snp_makeConstraints { (make) in
            make.top.equalTo(busDate.snp_bottom).offset(HEIGHT_DYNAMIC(28))
            make.left.equalTo(orderView).offset(WIDTH_DYNAMIC(20))
        }
        //乘客视图
        orderView.addSubview(psgView)
        psgView.snp_makeConstraints { (make) in
            make.top.equalTo(busDate.snp_bottom).offset(HEIGHT_DYNAMIC(25))
            make.left.equalTo(passenger.snp_right).offset(WIDTH_DYNAMIC(10))
//            make.right.equalTo(orderView).offset(-10)
        }
        

        //－－－－－－－－－－－－orderView底部－－－－－－－－－－－－－
        orderView.snp_updateConstraints { (make) in
//            make.bottom.equalTo(addPassgerBtn.snp_bottom).offset(10)
            make.bottom.equalTo(psgView.snp_bottom).offset(10
            )
        }
        
        //－－－－－－－－－－－－－－－－－comfirmView确认视图－－－－－－－－－－－－
        contentView.addSubview(comfirmView)
        comfirmView.layer.borderWidth=1
        comfirmView.layer.borderColor=COLOR_SEGMENTATION.CGColor
        comfirmView.backgroundColor=UIColor.whiteColor()
        comfirmView.snp_makeConstraints { (make) in
            make.top.equalTo(orderView.snp_bottom).offset(HEIGHT_DYNAMIC(15))
            make.left.right.equalTo(contentView).offset(0)
//            make.height.equalTo((130))
        }
        //通讯地址
        comfirmView.addSubview(connectAddress)
        connectAddress.text="通讯地址"
        connectAddress.font=UIFont.systemFontOfSize(13)
        connectAddress.snp_makeConstraints { (make) in
            make.top.equalTo(comfirmView).offset(HEIGHT_DYNAMIC(25))
            make.left.equalTo(comfirmView).offset(WIDTH_DYNAMIC(20))
        }
        //通讯地址输入框
//        comfirmView.addSubview(addressText)
//        addressText.placeholder="我们将为您配送乘车卡等相关资料"
//        addressText.font=UIFont.systemFontOfSize(12)
//        addressText.layer.borderWidth=1
//        addressText.layer.cornerRadius=2.5
//        addressText.layer.borderColor=COLOR_SEGMENTATION.CGColor
//        addressText.bounces=false
//        addressText.scrollEnabled=false
//        addressText.textColor=COLOR_TEXT
//        addressText.snp_makeConstraints { (make) in
//            make.top.equalTo(comfirmView).offset(HEIGHT_DYNAMIC(20))
//            make.left.equalTo(connectAddress.snp_right).offset(WIDTH_DYNAMIC(10))
////            make.right.equalTo(comfirmView).offset(WIDTH_DYNAMIC(-40))
//            make.width.equalTo(WIDTH_DYNAMIC(230))
//            make.height.equalTo(30)
//        }
        
        //addressDropMenu
//        addressDropMenu=ZHDropDownMenu()
//        addressDropMenu.dropMenuTag=3
//        addressDropMenu.placeholder="我们将为您配送乘车卡等相关资料"
//        addressDropMenu.delegate=self
//        addressDropMenu.buttonImage=UIImage(named: "icon_down")
//        addressDropMenu.editable=false
//        addressDropMenu.font=UIFont.systemFontOfSize(12)
//        addressDropMenu.textColor=COLOR_TEXT
//        addressDropMenu.layer.borderColor=COLOR_SEGMENTATION.CGColor
//        addressDropMenu.layer.borderWidth=1
//        addressDropMenu.options=[""]
//        addressDropMenu.defaultValue=""
//        scrollView.addSubview(addressDropMenu)
//        addressDropMenu.snp_makeConstraints { (make) in
//        make.top.equalTo(comfirmView).offset(HEIGHT_DYNAMIC(20))
//            make.left.equalTo(connectAddress.snp_right).offset(WIDTH_DYNAMIC(10))
//            make.width.equalTo(WIDTH_DYNAMIC(230))
//            make.height.equalTo(30)
//        }
        //新增地址按钮
        comfirmView.addSubview(addPassgerAddress)
        addPassgerAddress.setTitleColor(UIColor.blackColor(), forState: UIControlState.Normal)
        addPassgerAddress.setTitle("新增", forState: UIControlState.Normal)
        addPassgerAddress.titleLabel!.font=UIFont.systemFontOfSize(13)
        addPassgerAddress.layer.borderColor=COLOR_SEGMENTATION.CGColor
        addPassgerAddress.layer.borderWidth=1
        addPassgerAddress.layer.cornerRadius=2.5
        addPassgerAddress.snp_makeConstraints { (make) in
            make.top.equalTo(comfirmView).offset(HEIGHT_DYNAMIC(20))
            make.width.equalTo(WIDTH_DYNAMIC(40))
            make.right.equalTo(comfirmView).offset(WIDTH_DYNAMIC(-10))
            make.height.equalTo(30)
        }
        
        //确认乘车合同勾选框
        comfirmView.addSubview(agreementCbx)
        agreementCbx.selected=true
        agreementCbx.setImage(UIImage(named: "icon_m_sel"), forState: UIControlState.Selected)
        agreementCbx.setImage(UIImage(named: "icon_m_unsel"), forState: UIControlState.Normal)
        agreementCbx.addTarget(self, action: #selector(CPLineInfoView.agreementCbxClick), forControlEvents: UIControlEvents.TouchUpInside)
        agreementCbx.snp_makeConstraints { (make) in
            make.top.equalTo(addPassgerAddress.snp_bottom).offset(HEIGHT_DYNAMIC(15))
            make.left.equalTo(connectAddress.snp_right).offset(WIDTH_DYNAMIC(10))
        }
        //确认乘车合同勾选框文本
        let agreementLb=UILabel()
        comfirmView.addSubview(agreementLb)
        agreementLb.textColor=COLOR_TEXT
        agreementLb.text="我已确认"
        agreementLb.font=UIFont.systemFontOfSize(12)
        agreementLb.snp_makeConstraints { (make) in
            make.top.equalTo(addPassgerAddress.snp_bottom).offset(HEIGHT_DYNAMIC(18))
            make.left.equalTo(agreementCbx.snp_right).offset(WIDTH_DYNAMIC(5))
        }
        //乘车合同
        let agreement=UILabel()
        agreement.text="乘车合同"
        agreement.font=UIFont.systemFontOfSize(12)
        let agreementStr=NSMutableAttributedString(string: agreement.text!, attributes: attrs)
        agreement.attributedText=agreementStr
        comfirmView.addSubview(agreement)
        agreement.snp_makeConstraints { (make) in
            make.top.equalTo(addPassgerAddress.snp_bottom).offset(HEIGHT_DYNAMIC(18))
            make.left.equalTo(agreementLb.snp_right)
        }
        //并遵守
        let agreementLb2=UILabel()
        agreementLb2.textColor=COLOR_TEXT
        agreementLb2.text=",并遵守"
        agreementLb2.font=UIFont.systemFontOfSize(12)
        comfirmView.addSubview(agreementLb2)
        agreementLb2.snp_makeConstraints { (make) in
            make.top.equalTo(addPassgerAddress.snp_bottom).offset(HEIGHT_DYNAMIC(18))
            make.left.equalTo(agreement.snp_right)
        }
        //乘车规范
        let standard=UILabel()
        standard.text="乘车规范"
        standard.textColor=COLOR_TEXT
        standard.font=UIFont.systemFontOfSize(12)
        let standardStr=NSMutableAttributedString(string: standard.text!, attributes: attrs)
        standard.attributedText=standardStr
        comfirmView.addSubview(standard)
        standard.snp_makeConstraints { (make) in
            make.top.equalTo(addPassgerAddress.snp_bottom).offset(HEIGHT_DYNAMIC(18))
            make.left.equalTo(agreementLb2.snp_right)
        }
        
        //发票勾选框
        comfirmView.addSubview(billCbx)
        billCbx.selected=false
        billCbx.setImage(UIImage(named: "icon_m_sel"), forState: UIControlState.Selected)
        billCbx.setImage(UIImage(named: "icon_m_unsel"), forState: UIControlState.Normal)
        billCbx.addTarget(self, action: #selector(self.billCbxClick), forControlEvents: UIControlEvents.TouchUpInside)
        billCbx.snp_makeConstraints { (make) in
            make.top.equalTo(agreementCbx.snp_bottom).offset(HEIGHT_DYNAMIC(15))
            make.left.equalTo(connectAddress.snp_right).offset(WIDTH_DYNAMIC(10))
        }
        //发票文本
        let billLb=UILabel()
        comfirmView.addSubview(billLb)
        billLb.text="我要发票及纸质合同"
        billLb.font=UIFont.systemFontOfSize(12)
        billLb.textColor=COLOR_TEXT
        billLb.snp_makeConstraints { (make) in
            make.top.equalTo(agreementCbx.snp_bottom).offset(HEIGHT_DYNAMIC(18))
            make.left.equalTo(billCbx.snp_right).offset(WIDTH_DYNAMIC(5))
        }
        comfirmView.snp_updateConstraints { (make) in
            make.bottom.equalTo(billLb.snp_bottom).offset(20)
        }
        //-----------------------购票按钮----------------------
        contentView.addSubview(submit)
        submit.backgroundColor=COLOR_TEXT_YELLOW
        submit.setTitle("提交订单", forState: UIControlState.Normal)
        submit.setTitleColor(UIColor(red: 154/255, green: 154/255, blue: 154/255, alpha: 1), forState: UIControlState.Disabled)
        submit.addTarget(self, action: #selector(self.submitClick), forControlEvents: UIControlEvents.TouchUpInside)
        submit.titleLabel?.font=UIFont.systemFontOfSize(15)
        submit.layer.cornerRadius=WIDTH_DYNAMIC(15)
        submit.snp_makeConstraints { (make) in
            make.top.equalTo(comfirmView.snp_bottom).offset(HEIGHT_DYNAMIC(15))
            make.left.equalTo(contentView).offset(WIDTH_DYNAMIC(40))
            make.right.equalTo(contentView).offset(WIDTH_DYNAMIC(-40))
        }
        
        //----------------------contentView边界--------------------
        contentView.snp_updateConstraints { (make) in
            make.edges.equalTo(scrollView).offset(UIEdgeInsetsZero)
            make.width.equalTo(self.bounds.size.width)
            make.bottom.equalTo(submit.snp_bottom).offset(HEIGHT_DYNAMIC(10))
        }

        //---------------------日期视图---------------------------
        contentView.addSubview(dateView)
        dateView.hidden=true
        dateView.backgroundColor=UIColor(red: 154/255, green: 154/255, blue: 154/255, alpha: 0.5)
        dateView.snp_makeConstraints { (make) in
            make.edges.equalTo(contentView).offset(UIEdgeInsetsZero)
        }

        //----------------calendarView--start---------------
        NSNotificationCenter.defaultCenter().addObserver(self, selector: #selector(CPLineInfoView.getNewDate(_:)), name: "date", object: nil)
        scrollView.addSubview(calendarView)
        calendarView.hidden=true
        calendarView.frame.size=CGSizeMake(300, 300)

        calendarView.layer.borderWidth = 1
        calendarView.layer.borderColor = UIColor.lightGrayColor().CGColor
        calendarView.backgroundColor = UIColor.whiteColor()
        
        
//        let date = NSDate()
//        let newDate = date.dateByAddingTimeInterval(60*60*24*2)
//        let newDate2 = date.dateByAddingTimeInterval(60*60*24*3)
//        let newDate3 = date.dateByAddingTimeInterval(60*60*24*4)
        
//        calendarView.disabledDates = [newDate3]
//        calendarView.disableSundays = true
//        calendarView.availableDates = [newDate2, newDate3]
//        calendarView.selectedDates = [newDate2]
//        calendarView.maxMonths = 4
        calendarView.selectionRangeLength = 1
        calendarView.delegate = self

        calendarView.createCalendar()
//        calendarView.scrollToDate(newDate3, animated: true)

        //---------------------calendarView--end-------------------
        
        
    }
    
    //addressDropMenu
    var psgAddressAr2:Int=1 {
        didSet{
            addressDropMenu.dropMenuTag=3
            addressDropMenu.placeholder="我们将为您配送乘车卡等相关资料"
            addressDropMenu.delegate=self
            addressDropMenu.buttonImage=UIImage(named: "icon_down")
            addressDropMenu.editable=false
            addressDropMenu.font=UIFont.systemFontOfSize(12)
            addressDropMenu.textColor=COLOR_TEXT
            addressDropMenu.layer.borderColor=COLOR_SEGMENTATION.CGColor
            addressDropMenu.layer.borderWidth=1
            addressDropMenu.options=[""]
            addressDropMenu.defaultValue=""
//            scrollView.addSubview(addressDropMenu)
            //        addressDropMenu.options=addressAr
            scrollView.insertSubview(addressDropMenu, belowSubview: calendarView)
            addressDropMenu.snp_makeConstraints { (make) in
                make.top.equalTo(comfirmView).offset(HEIGHT_DYNAMIC(20))
                make.left.equalTo(connectAddress.snp_right).offset(WIDTH_DYNAMIC(10))
                make.width.equalTo(WIDTH_DYNAMIC(230))
                make.height.equalTo(30)
            }
            let addressAr=NSMutableArray()
            if(psgAddressAr.count>0){
                for i in 0..<psgAddressAr.count{
                    let address=psgAddressAr[i].objectForKey("address")!
                    addressAr.addObject(address)
                }
                dropRowAddress=0
                addressDropMenu.options=addressAr
                addressDropMenu.defaultValue=(addressAr[0] as! String)
            }


        }
        
    }

    
    
    func getNewDate(notifaction: NSNotification) {
        self.newDateArray = notifaction.object as! NSMutableArray
        let availableArray=NSMutableArray()
        for i in 0..<newDateArray.count {
            availableArray.addObject(newDateArray[i])
        }
        calendarView.availableDates=(availableArray as! [NSDate])
        
        NSNotificationCenter.defaultCenter().removeObserver(self)
    }

    //日期选择框
    func dateChoose(){
        dateView.hidden=false
        calendarView.hidden=false
    }
    

    //合同单选框
    func agreementCbxClick(){
        agreementCbx.selected = !agreementCbx.selected
        if !agreementCbx.selected {
            submit.enabled=false
            submit.backgroundColor=UIColor.lightGrayColor()
        }else{
            submit.enabled=true
            submit.backgroundColor=COLOR_TEXT_YELLOW
        }
    }
    //发票
    func billCbxClick(){
        billCbx.selected = !billCbx.selected
        if billCbx.selected==true {
            isNeedContract=1
        }else{
            isNeedContract=0
        }
    }
    //提交
    func submitClick(){
        submit.backgroundColor=UIColor.orangeColor()
    }
    
    //通讯地址Id
    func getUasId()->Int{
        var uasId:Int!
        uasId = -1
        if dropRowAddress != nil {
            uasId=psgAddressAr[dropRowAddress].objectForKey("uasId") as! Int
        }
        return uasId

    }
    
    //选择完后回调
    func dropDownMenu(menu: ZHDropDownMenu!, didChoose index: Int, dropMenuTag:Int ) {
        if(dropMenuTag==1){
            dropRowW=index
            timeValue.text=stationListAr[dropRowW].objectForKey("departTime") as? String
        }
        if(dropMenuTag==2){
            dropRowF=index
            timeBackValue.text=stationListArBack[dropRowF].objectForKey("departTime") as? String
        }
        if(dropMenuTag==3){
            dropRowAddress=index
        }
        
    }

    
    //编辑完成后回调
    func dropDownMenu(menu: ZHDropDownMenu!, didInput text: String!) {
        //        print("\(menu) input text \(text)")
    }
    
    func psgRefresh(){
        for i in 0..<psgButtonArray.count{
            psgButtonArray[i].removeFromSuperview()
        }
        
    }
    
    //乘客列表
    var resultList:NSArray! {
        didSet{
//            if(resultList.count != 0){
                let constantValue:Int=2
                let resultCount=resultList.count+1
                var num:Int!
                psgIdsSelectedAr.removeAllObjects()
                for m in 0..<resultList.count{
                    psgIdsSelectedAr.addObject(0)
                }
                if(resultCount%constantValue==0){
                    num=Int(resultCount/constantValue)
                    
                }else{
                    num=Int(resultCount/constantValue)+1
                }
                psgButtonArray.removeAll()
                var k:Int!
                for i in 0..<num {
                    for j in 0..<constantValue{
                        k=i*constantValue+j
                        if(k>=resultCount){
//                            print("超出范围")
                            break
                        }
                        else{
                            if(k==resultCount-1){
                                //addPassgerBtn,添加乘客按钮
                                orderView.addSubview(addPassgerBtn)
                                addPassgerBtn.setImage(UIImage(named: "icon_add_passenger"), forState: UIControlState.Normal)
                                addPassgerBtn.setTitle("添加乘客", forState: UIControlState.Normal)
                                addPassgerBtn.setTitleColor(UIColor.blackColor(), forState: UIControlState.Normal)
                                addPassgerBtn.titleLabel!.font=UIFont.systemFontOfSize(13)
                                addPassgerBtn.snp_makeConstraints { (make) in
                                    make.top.equalTo(psgView).offset(i*30)
                                    make.left.equalTo(psgView).offset(j*110)
                                }
                                psgView.snp_updateConstraints(closure: { (make) in
                                    make.height.equalTo(30*(i+1))
                                })
                                psgButtonArray.append(addPassgerBtn)
                                break
                            }
                            //passgerCbx
                            let passgerCbx=UIButton()       //乘客多选框
                            orderView.addSubview(passgerCbx)
                            passgerCbx.selected=false
                            passgerCbx.tag=100+k
                            passgerCbx.setImage(UIImage(named: "icon_m_sel"), forState: UIControlState.Selected)
                            passgerCbx.setImage(UIImage(named: "icon_m_unsel"), forState: UIControlState.Normal)
                            passgerCbx.addTarget(self, action: #selector(CPLineInfoView.passgerCbxClick(_:)), forControlEvents: UIControlEvents.TouchUpInside)
                            passgerCbx.userInteractionEnabled=true
                            passgerCbx.setTitle(((resultList[k].objectForKey("psgName")) as! String), forState: UIControlState.Normal)
                            passgerCbx.setTitleColor(UIColor.blackColor(), forState: UIControlState.Normal)
                            passgerCbx.titleLabel!.font=UIFont.systemFontOfSize(14)
                            passgerCbx.snp_makeConstraints(closure: { (make) in
                                make.top.equalTo(psgView).offset(i*30)
                                make.left.equalTo(psgView).offset(j*110)
                            })
                            psgButtonArray.append(passgerCbx)
                        }
                    }
//                }
                
                
            }
            
 
        }

    }


    
    //乘客多选按钮
    func passgerCbxClick(sender:UIButton){
        sender.selected = !sender.selected
        psgIdsSelectedAr.replaceObjectAtIndex(sender.tag-100, withObject: sender.selected == true ? 1 : 0)
        
    }

}


extension CPLineInfoView: NWCalendarViewDelegate {
    func didChangeFromMonthToMonth(fromMonth: NSDateComponents, toMonth: NSDateComponents) {
//        let dateFormatter: NSDateFormatter = NSDateFormatter()
//        let months = dateFormatter.standaloneMonthSymbols
//        let fromMonthName = months[fromMonth.month-1] as String
//        let toMonthName = months[toMonth.month-1] as String
//        print("Change From '\(fromMonthName)' to '\(toMonthName)'")
    }
    
    func didSelectDate(fromDate: NSDateComponents, toDate: NSDateComponents) {
//        print("Selected date '\(fromDate.month)/\(fromDate.day)/\(fromDate.year)' to date '\(toDate.month)/\(toDate.day)/\(toDate.year)'")
        busDateKit.text="\(toDate.year)年\(toDate.month)月\(toDate.day)日"
        startDate="\(toDate.year)-\(toDate.month)-\(toDate.day)"
        dateView.hidden=true
        calendarView.hidden=true
    }

}
